module.exports=function(t){function r(e){if(n[e])return n[e].exports;var o=n[e]={exports:{},id:e,loaded:!1};return t[e].call(o.exports,o,o.exports,r),o.loaded=!0,o.exports}var n={};return r.m=t,r.c=n,r.p="",r(0)}([function(t,r,n){"use strict";var e=n(1);r.createServer=e.createServer;var o=n(13);r.createClient=o.createClient},function(t,r,n){"use strict";function e(t){void 0===t&&(t={});var r="number"==typeof t?{port:t}:t,n={host:r.host||"0.0.0.0",port:r.port||8080,serializer:r.serializer||new p.Msgpack},e={transport:new l(n),backoff:t.backoff||new h.BackoffExponential};return new c.Server(e)}var o=this&&this.__extends||function(t,r){function n(){this.constructor=t}for(var e in r)r.hasOwnProperty(e)&&(t[e]=r[e]);t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)},i=n(2),s=n(3),a=n(4),u=n(6),c=n(7),p=n(10),h=n(12),f=function(t){function r(){t.apply(this,arguments)}return o(r,t),r.prototype.setSocket=function(t){var r=this;this.out=new a.LPEncoderStream(t),this["in"]=new a.LPDecoderStream(t),this["in"].on("data",function(t){var n=r.transport.unserialize(t);r.onmessage(n)})},r.prototype.send=function(t){var r=this.transport.serialize(t);this.out.write(r)},r}(s.Connection);r.ConnectionTcp=f;var l=function(t){function r(n){t.call(this,i.extend({},r.defaults,n)),this.ClassConnection=f}return o(r,t),r.prototype.start=function(t,r){var n=this;this.server=u.createServer(),this.server.on("connection",function(t){var r=n.createConncetion();r.setSocket(t),n.onconnection(r)}),this.server.on("error",function(t){n.onerror(t),n.server.close(),r()}),this.server.on("close",function(){n.onstop()}),this.server.listen({host:this.opts.host,port:this.opts.port},function(){n.onstart(),t()})},r.prototype.stop=function(){this.server.close()},r.defaults={host:"127.0.0.1",port:8080,serializer:new p.Msgpack},r}(s.Transport);r.TransportTcp=l,r.createServer=e},function(t,r){"use strict";function n(t,r){for(var e=[],o=2;o<arguments.length;o++)e[o-2]=arguments[o];if("object"==typeof r)for(var i in r)t[i]=r[i];return e.length?n.apply(null,[t].concat(e)):t}function e(){}r.extend=n,r.noop=e},function(t,r,n){"use strict";var e=this&&this.__extends||function(t,r){function n(){this.constructor=t}for(var e in r)r.hasOwnProperty(e)&&(t[e]=r[e]);t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)},o=n(2),i=function(){function t(){this.onmessage=o.noop}return t}();r.Connection=i;var s=function(){function t(t){this.opts={serializer:null},this.onconnection=o.noop,this.onstart=o.noop,this.onstop=o.noop,this.onerror=o.noop,this.opts=o.extend(this.opts,t)}return t.prototype.createConncetion=function(){var t=new this.ClassConnection;return t.transport=this,t.serializer=this.opts.serializer,t},t.prototype.serialize=function(t){return this.opts.serializer.pack(t)},t.prototype.unserialize=function(t){return this.opts.serializer.unpack(t)},t}();r.Transport=s;var a=function(t){function r(){t.apply(this,arguments),this.onmessage=o.noop}return e(r,t),r}(s);r.ClientTransport=a},function(t,r,n){"use strict";var e=this&&this.__extends||function(t,r){function n(){this.constructor=t}for(var e in r)r.hasOwnProperty(e)&&(t[e]=r[e]);t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)},o=n(5),i=function(){function t(){}return t.prototype.encode=function(t){var r=new Buffer(4);return r.writeInt32BE(t.length,0),Buffer.concat([r,t])},t}();r.LPEncoder=i;var s=function(){function t(){this.buf=new Buffer("")}return t.prototype.add=function(t){return this.buf=Buffer.concat([this.buf,t]),this},t.prototype.shift=function(){if(this.buf.length<5)return null;var t=this.buf.readInt32BE(0);if(this.buf.length>t){var r=this.buf.slice(4,t+4);return this.buf=this.buf.slice(t+4),r}return null},t}();r.LPDecoder=s;var a=function(t){function r(r){t.call(this),this.encoder=new i,r&&this.pipe(r)}return e(r,t),r.prototype._transform=function(t,r,n){var e=t;"string"==typeof t&&(e=new Buffer(t,r));var o=this.encoder.encode(e);n(null,o)},r}(o.Transform);r.LPEncoderStream=a;var u=function(t){function r(r){t.call(this),this.decoder=new s,r&&r.pipe(this)}return e(r,t),r.prototype._transform=function(t,r,n){var e=t;"string"==typeof t&&(e=new Buffer(t,r)),this.decoder.add(e);for(var o;o=this.decoder.shift();)this.push(o);n()},r}(o.Transform);r.LPDecoderStream=u;var c=function(t){function r(){t.call(this)}return e(r,t),r.prototype._transform=function(t,r,n){n()},r}(o.Transform);r.Buffered=c},function(t,r){t.exports=require("stream")},function(t,r){t.exports=require("net")},function(t,r,n){"use strict";var e=n(2),o=n(8),i=function(){function t(t){var r=this;this.router=new o.Router,this.onmessage=e.noop,this.connection=t,this.connection.onmessage=function(t){r.onmessage(t,r),r.router.onmessage(t)},this.router.send=this.send.bind(this)}return t.prototype.send=function(t){return this.connection.send(t),this},t}();r.Socket=i;var s=function(){function t(t){void 0===t&&(t={}),this.opts={},this.isStarted=!1,this.api=new o.Api,this.onsocket=e.noop,this.onstart=e.noop,this.onstop=e.noop,this.onerror=e.noop,this.opts=e.extend(this.opts,t)}return t.prototype.createSocket=function(t){var r=new i(t);return r.router.setApi(this.api),r},t.prototype.onStart=function(){this.isStarted=!0,this.onstart()},t.prototype.onStop=function(){this.isStarted=!1,this.onstop()},t.prototype.onError=function(t){this.onerror(t)},t.prototype.onConnection=function(t){this.onsocket(this.createSocket(t))},t.prototype.tryStart=function(t,r){var n=this.opts.transport;n.onconnection=this.onConnection.bind(this),n.onstart=this.onStart.bind(this),n.onstop=this.onStop.bind(this),n.onerror=this.onError.bind(this),n.start(t,r)},t.prototype.start=function(){return this.opts.backoff.attempt(this.tryStart.bind(this)),this},t.prototype.stop=function(){return this.opts.transport.stop(),this},t}();r.Server=s},function(t,r,n){"use strict";var e=this&&this.__extends||function(t,r){function n(){this.constructor=t}for(var e in r)r.hasOwnProperty(e)&&(t[e]=r[e]);t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)},o=n(9),i=function(){function t(){this.data=null,this.id=0,this.event="",this.args=[],this.callbacks=[],this.rid=0,this.func=0,this.timeout=t.timeout}return t.getNextId=function(){return t.id=t.id%1e9+1},t.prototype.hasCallbacks=function(){for(var t=0,r=this.args;t<r.length;t++){var n=r[t];if("function"==typeof n)return!0}return!1},t.prototype.isResponse=function(){return!!this.rid},t.id=0,t.timeout=5e3,t}();r.Frame=i;var s=function(t){function r(r,n){void 0===r&&(r=[]),void 0===n&&(n=""),t.call(this),this.id=i.getNextId(),this.event=n,this.args=r}return e(r,t),r.createResponse=function(t,n,e){var o=new r(e);return o.rid=t.id,o.func=n,o},r.prototype.processResponse=function(t){var r=t.func,n=this.args[r];"function"==typeof n&&(this.args[r]=null,n.apply(null,t.args))},r.prototype.serialize=function(){var t={i:this.id,e:this.event};if(this.args.length){t.a=[];for(var r=[],n=0;n<this.args.length;n++){var e=this.args[n];"function"==typeof e?(r.push(n),this.callbacks.push(e)):(t.a.push(e),i.timeout!=this.timeout&&(t.t=this.timeout/1e3))}r.length&&(t.c=r)}return this.rid&&(t.r=this.rid,t.f=this.func),this.data=t,this.data},r}(i);r.FrameOutgoing=s;var a=function(t){function r(){t.apply(this,arguments)}return e(r,t),r.prototype.unserialize=function(t,r){if(this.data=t,"number"!=typeof t.i)throw Error("Error parsing id");if(this.id=t.i,t.t){if("number"!=typeof t.t)throw Error("Error parsing timeout");this.timeout=t.t}else this.timeout=i.timeout;if(this.args=[],t.a){if(!(t.a instanceof Array))throw Error("Error parsing arguments");for(var n=0,e=t.a;n<e.length;n++){var o=e[n];this.args.push(o)}}else t.a=[];if(this.callbacks=[],t.c){if(!(t.c instanceof Array))throw Error("Error parsing callbacks");for(var s=0,a=t.c;s<a.length;s++){var u=a[s],c=r(this,u);this.callbacks.push(c),this.args.splice(u,0,c)}}if(this.event="",this.rid=0,this.func=0,t.e){if("string"!=typeof t.e)throw Error("Error parsing event");this.event=t.e}else if(t.r){if("number"!=typeof t.r)throw Error("Error parsing resposne id");if(this.rid=t.r,"number"!=typeof t.f)throw Error("Error parsing reponse position");this.func=t.f}},r}(i);r.FrameIncoming=a;var u=function(){function t(){this.latency=500,this.frame={},this.timer={},this.onerror=function(){},this.api=null,this.subs={}}return t.prototype.genCallack=function(t,r){var n=this,e=!1;return function(){for(var o=[],i=0;i<arguments.length;i++)o[i-0]=arguments[i];if(e)throw Error('Already called: .on("'+t.event+'") '+r+"th arg");e=!0,n.dispatch(s.createResponse(t,r,o))}},t.prototype.pub=function(t){var r=t.event,n=t.args;if(r){this.onevent&&this.onevent(r,n);var e;if(this.api&&(e=this.api.get(r)),e)e.apply(this,n);else{var o=this.subs[r];o&&o.apply(null,n),o=this.subs["*"],o&&o.apply(null,[r].concat(n))}}},t.prototype.sendData=function(t){this.send(t)},t.prototype.dispatch=function(t){var r=this;t.hasCallbacks()&&(this.frame[t.id]=t,this.timer[t.id]=setTimeout(function(){delete r.frame[t.id]},t.timeout+this.latency));var n=t.serialize();this.sendData(n)},t.prototype.processResponse=function(t){var r=this.frame[t.rid];if(r&&(r.processResponse(t),!r.hasCallbacks())){var n=r.id;delete this.frame[n];var e=this.timer[n];e&&clearTimeout(e),delete this.timer[n]}},t.prototype.setApi=function(t){return this.api=t,this},t.prototype.onmessage=function(t){var r=new a;try{r.unserialize(t,this.genCallack.bind(this))}catch(n){return void this.onerror(n)}r.isResponse()?this.processResponse(r):this.pub(r)},t.prototype.on=function(t,r){return this.subs[t]=r,this},t.prototype.emit=function(t){for(var r=[],n=1;n<arguments.length;n++)r[n-1]=arguments[n];var e=new s(r,t);return this.dispatch(e),this},t}();r.Router=u;var c=function(t){function r(){t.apply(this,arguments),this.cycle=10,this.timer=0,this.buffer=[]}return e(r,t),r.prototype.flush=function(){this.send(this.buffer),this.buffer=[]},r.prototype.sendData=function(t){this.buffer.push(t),this.startTimer()},r.prototype.startTimer=function(){var t=this;this.timer||(this.timer=setTimeout(function(){t.timer=0,t.flush()},this.cycle))},r.prototype.onmessage=function(r){if("object"==typeof r)if(r instanceof Array)for(var n=0,e=r;n<e.length;n++){var o=e[n];t.prototype.onmessage.call(this,o)}else t.prototype.onmessage.call(this,r)},r}(u);r.RouterBuffered=c;var p=function(){function t(){this.methods={}}return t.prototype.add=function(t){return this.methods=o.extend(this.methods,t),this},t.prototype.get=function(t){return this.methods[t]},t}();r.Api=p},function(t,r){"use strict";function n(t,r){for(var e=[],o=2;o<arguments.length;o++)e[o-2]=arguments[o];if("object"==typeof r)for(var i in r)t[i]=r[i];return e.length?n.apply(null,[t].concat(e)):t}r.extend=n},function(t,r,n){"use strict";var e=function(){function t(){}return t.prototype.pack=function(t){var r=n(11);return r.encode(t)},t.prototype.unpack=function(t){var r=n(11);return r.decode(t)},t}();r.Msgpack=e},function(t,r){t.exports=require("msgpack-lite")},function(t,r){"use strict";var n=this&&this.__extends||function(t,r){function n(){this.constructor=t}for(var e in r)r.hasOwnProperty(e)&&(t[e]=r[e]);t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)},e=function(){function t(){this.retryCount=0}return t.prototype.onSuccess=function(){this.retryCount=0},t.prototype.retry=function(){this.retryCount++,this.operation(this.onSuccess.bind(this),this.onError.bind(this))},t.prototype.attempt=function(t){this.operation=t,this.retry()},t}();r.Backoff=e;var o=function(t){function r(r){void 0===r&&(r=3),t.call(this),this.maxRetries=3,this.maxRetries=r}return n(r,t),r.prototype.onError=function(t){this.retryCount<this.maxRetries&&this.retry()},r}(e);r.BackoffRetry=o;var i=function(t){function r(){t.apply(this,arguments),this.minTimeout=1e3,this.base=2,this.maxTimeout=36e5}return n(r,t),r.prototype.onError=function(t){var r=this.minTimeout*Math.pow(this.base,this.retryCount-1);r<this.maxTimeout&&setTimeout(this.retry.bind(this),r)},r}(e);r.BackoffExponential=i},function(t,r,n){"use strict";function e(t){void 0===t&&(t={});var r="number"==typeof t?{port:t}:t,n={host:r.host||"127.0.0.1",port:r.port||8080,serializer:r.serializer||new p.Msgpack},e={transport:new f(n),backoff:r.backoff||new h.BackoffExponential,queue:r.queue||1e3};return new c.Client(e)}var o=this&&this.__extends||function(t,r){function n(){this.constructor=t}for(var e in r)r.hasOwnProperty(e)&&(t[e]=r[e]);t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)},i=n(2),s=n(3),a=n(4),u=n(6),c=n(14),p=n(10),h=n(12),f=function(t){function r(n){void 0===n&&(n={}),t.call(this,i.extend({},r.defaults,n))}return o(r,t),r.prototype.createStreams=function(){var t=this;this.socket=new u.Socket,this.out=new a.LPEncoderStream,this["in"]=new a.LPDecoderStream,this.out.on("error",function(r){t.onerror(r)}),this["in"].on("error",function(r){t.onerror(r)})},r.prototype.start=function(t,r){var n=this;this.createStreams(),this.out.pipe(this.socket),this.socket.pipe(this["in"]),this["in"].on("data",this.onMessage.bind(this)),this.socket.on("error",function(t){n.onerror(t),r()}).on("close",function(){n.onstop()}).connect(this.opts.port,this.opts.host,function(){n.onstart(),t()})},r.prototype.stop=function(){this.socket.end()},r.prototype.onMessage=function(t){var r=this.unserialize(t);this.onmessage(r)},r.prototype.send=function(t){var r=this.serialize(t);try{this.out.write(r)}catch(n){this.onerror(n)}},r.defaults={host:"127.0.0.1",port:8080,serializer:null},r}(s.ClientTransport);r.ClientTransportTcp=f,r.createClient=e},function(t,r,n){"use strict";var e=this&&this.__extends||function(t,r){function n(){this.constructor=t}for(var e in r)r.hasOwnProperty(e)&&(t[e]=r[e]);t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)},o=n(2),i=n(7),s=n(8),a=n(15),u=function(t){function r(r){var n=this;void 0===r&&(r={}),t.call(this,r),this.router=new s.Router,this.onmessage=o.noop,this.queue=new a.Queue(r.queue),this.opts.transport.onmessage=function(t){n.onmessage(t),n.router.onmessage(t)},this.router.send=this.send.bind(this)}return e(r,t),r.prototype.onStart=function(){t.prototype.onStart.call(this),this.drainQueue()},r.prototype.drainQueue=function(){for(var t,r=this.opts.transport;t=this.queue.shift();)r.send(t)},r.prototype.send=function(t){return this.isStarted?this.opts.transport.send(t):this.queue.add(t),this},r}(i.Server);r.Client=u},function(t,r){"use strict";var n=function(){function t(t){void 0===t&&(t=1e3),this.data=[],this.max=t}return t.prototype.add=function(t){this.data.push(t),this.data.length>this.max&&this.shift()},t.prototype.shift=function(){return this.data.shift()},t}();r.Queue=n}]);